# 更新日志

## 2026-01-19 - 关键修复 v1.0.6

### 修复的问题
- **问题**: AI思考时棋盘上的棋子不停闪动（真正原因）
- **原因**: AI直接在原始棋盘上执行make_move/undo_move，UI重绘时看到中间状态
- **解决方案**: AI使用棋盘副本进行思考，不修改原始棋盘

### 修改的文件
- `ai/alphabeta_ai.py` - 使用棋盘副本
- `ai/minimax_ai.py` - 使用棋盘副本
- `ai/greedy_ai.py` - 使用棋盘副本

### 优化效果
- ✅ 彻底解决棋子闪烁问题
- ✅ AI思考时棋盘完全稳定
- ✅ 原始棋盘状态不被修改

---

## 2026-01-19 - 显示优化 v1.0.5

### 修复的问题
- **问题**: AI思考时棋盘上的棋子不停闪动
- **原因**: 帧率过高（60 FPS）导致视觉闪烁
- **解决方案**: 降低帧率到30 FPS

### 修改的文件
- `config.py` - 帧率从60降低到30

### 优化效果
- ✅ 棋子不再闪烁
- ✅ 画面更稳定流畅
- ✅ 降低CPU占用

---

## 2026-01-19 - UI优化 v1.0.4

### 优化内容
- **UI简化**: 简化AI思考信息显示
  - 移除详细的候选走法、评分等信息
  - 只显示简洁的"思考中..."提示
  - 界面更清爽，不再混乱

### 修改的文件
- `ui/info_panel.py` - 简化AI思考信息显示

### 优化效果
- ✅ 界面更简洁清爽
- ✅ AI思考时不显示复杂信息
- ✅ 等待AI走棋后直接看结果

---

## 2026-01-19 - 性能优化 v1.0.3

### 优化内容
- **优化1**: AI思考速度大幅提升
  - AlphaBetaAI: 搜索深度 5→3，时间限制 10秒→3秒
  - MinimaxAI: 搜索深度 3→2
  - 思考时间从几分钟降低到1-3秒
- **优化2**: UI显示逻辑已是最优（AI在独立线程思考，不影响界面）

### 修改的文件
- `ai/alphabeta_ai.py` - 降低默认深度和时间限制
- `game/game_manager.py` - 更新AI创建参数

### 性能对比
| AI类型 | 思考时间 | 难度 |
|--------|---------|------|
| 新手小卒 | < 0.1秒 | ⭐ |
| 贪心将军 | < 0.5秒 | ⭐⭐ |
| 谋略军师 | 0.5-1秒 | ⭐⭐⭐ |
| 深算国手 | 1-3秒 | ⭐⭐⭐⭐ |

---

## 2026-01-19 - Bug修复 v1.0.2

### 修复的问题
- **问题3**: macOS上所有中文文字显示为乱码
- **原因**: Pygame默认字体不支持中文字符
- **解决方案**: 在所有UI组件中使用macOS系统中文字体 (STHeiti Medium.ttc)

### 修改的文件
3. `ui/board_renderer.py` - 棋盘河界文字字体
4. `ui/piece_renderer.py` - 棋子文字字体
5. `ui/info_panel.py` - 信息面板字体
6. `ui/menu.py` - 菜单和对话框字体

### 字体加载策略
1. 优先使用 macOS 系统字体: `/System/Library/Fonts/STHeiti Medium.ttc`
2. 备选方案: `pygame.font.SysFont('simhei')`
3. 最后备选: 默认字体（不支持中文）

---

## 2026-01-19 - Bug修复 v1.0.1

### 修复的问题
- **问题1**: 游戏启动时出现 `'NoneType' object has no attribute 'player_type'` 错误（游戏管理器）
- **问题2**: 信息面板绘制时出现 `'NoneType' object has no attribute 'player_type'` 错误
- **原因**: 游戏管理器和UI组件在玩家未初始化时调用了玩家相关方法
- **解决方案**: 在所有玩家相关方法和UI组件中添加空值检查

### 修改的文件
1. `game/game_manager.py`
   - `is_current_player_ai()`: 添加 `player is not None` 检查
   - `get_ai_move()`: 添加 `player is None` 检查
   - `get_ai_thinking_info()`: 添加 `player is not None` 检查
   - `get_game_status_text()`: 添加玩家为空时的提示文本 "请选择游戏模式"

2. `ui/info_panel.py`
   - `_draw_game_info()`: 添加红方和黑方玩家的空值检查
   - 未初始化时显示 "红方: 未设置" 和 "黑方: 未设置"

### 测试结果
✅ 所有模块导入成功
✅ 空值检查正常工作
✅ 游戏初始化流程正常
✅ 信息面板绘制正常（未初始化和已初始化状态）
✅ 中文字体显示正常
✅ AI思考速度优化完成

### 如何运行
```bash
python3 main.py
```

游戏启动后会显示游戏模式选择对话框，选择模式后即可开始游戏。
