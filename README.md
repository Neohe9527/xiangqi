# 中国象棋游戏

一个功能完整的中国象棋桌面游戏，使用 Python + Pygame 实现。

## 功能特性

### 核心功能
- ✅ 完整的中国象棋规则实现
- ✅ 人机对弈模式
- ✅ AI vs AI 对弈模式
- ✅ 悔棋功能
- ✅ 走棋历史记录
- ✅ 游戏状态显示

### AI 系统
提供 4 个不同难度的 AI 对手：

1. **新手小卒** (RandomAI)
   - 算法：随机选择合法走法
   - 难度：⭐
   - 适合：初学者建立信心

2. **贪心将军** (GreedyAI)
   - 算法：贪心算法，优先吃子
   - 难度：⭐⭐
   - 特点：激进但缺乏长远规划

3. **谋略军师** (MinimaxAI)
   - 算法：Minimax 搜索（深度 3-4 层）
   - 难度：⭐⭐⭐
   - 特点：有战术深度，能看到 2-3 步后的局面

4. **深算国手** (AlphaBetaAI)
   - 算法：Alpha-Beta 剪枝（深度 5-7 层）
   - 难度：⭐⭐⭐⭐
   - 特点：接近业余高手水平
   - 增强功能：
     - 迭代加深搜索
     - 置换表缓存
     - 走法排序优化

### AI 思考可视化
- 实时显示搜索深度
- 显示已评估的局面数量
- 显示局面评分和优势方
- 显示候选走法及其评分

## 技术架构

### 分层设计
```
UI 层 (Pygame)
    ↓
Game 层 (游戏管理)
    ↓
Core 层 (核心逻辑) + AI 层 (人工智能)
```

### 项目结构
```
xiangqi/
├── main.py                 # 程序入口
├── config.py              # 全局配置
├── core/                  # 核心游戏逻辑
│   ├── board.py          # 棋盘状态管理
│   ├── piece.py          # 棋子定义和移动规则
│   ├── rules.py          # 游戏规则（将军、胜负判定）
│   └── move.py           # 走法表示
├── ai/                    # AI 引擎
│   ├── base_ai.py        # AI 基类接口
│   ├── random_ai.py      # 随机 AI
│   ├── greedy_ai.py      # 贪心 AI
│   ├── minimax_ai.py     # Minimax AI
│   ├── alphabeta_ai.py   # Alpha-Beta AI
│   └── evaluator.py      # 局面评估函数
├── ui/                    # 用户界面
│   ├── game_window.py    # 主游戏窗口
│   ├── board_renderer.py # 棋盘渲染
│   ├── piece_renderer.py # 棋子渲染
│   ├── info_panel.py     # 信息面板
│   └── menu.py           # 菜单系统
└── game/                  # 游戏管理
    ├── game_manager.py   # 游戏状态管理
    ├── player.py         # 玩家抽象
    └── history.py        # 走棋历史记录
```

## 安装和运行

### 环境要求
- Python 3.8+
- Pygame 2.x

### 安装依赖
```bash
pip install pygame
```

### 运行游戏
```bash
cd xiangqi
python3 main.py
```

### 运行测试
```bash
python3 test_game.py
```

## 使用说明

### 开始游戏
1. 运行程序后会弹出游戏模式选择对话框
2. 选择"人机对弈"或"AI 对弈"
3. 点击"开始游戏"

### 人机对弈
- 点击己方棋子选中
- 绿色圆圈显示可走位置
- 点击目标位置完成移动
- 黄色高亮显示当前选中的棋子
- 红色圆圈提示将军状态

### 菜单功能
- **新游戏**：重新选择游戏模式
- **悔棋**：人机对弈时悔两步（人和 AI 各一步）
- **重置**：重置当前游戏到初始状态

### AI vs AI 模式
- 自动进行对弈
- 实时显示双方思考信息
- 可以观察不同 AI 的策略差异

## 技术亮点

### 核心算法
1. **走法生成**
   - 为每种棋子实现特定的移动规则
   - 马：日字，检查蹩马腿
   - 象：田字，不能过河
   - 炮：隔子吃子
   - 将/帅：九宫格内，不能对面

2. **Alpha-Beta 剪枝**
   - 大幅减少搜索节点数
   - 置换表缓存已评估局面
   - 走法排序提高剪枝效率
   - 迭代加深搜索

3. **局面评估**
   - 子力价值（40%）
   - 位置价值（25%）
   - 灵活性（15%）
   - 将帅安全（10%）
   - 子力协调（10%）

4. **Zobrist 哈希**
   - 快速计算棋盘哈希值
   - 增量更新，高效实现置换表

### 性能优化
- 使用位运算优化边界检查
- 走法排序提高剪枝效率
- 置换表缓存已评估局面
- 多线程处理 AI 思考，保持 UI 响应

## 测试结果

所有核心功能测试通过：
- ✅ 棋盘初始化（32 个棋子正确放置）
- ✅ 走法生成（红黑双方各 44 个初始合法走法）
- ✅ AI 算法（4 种 AI 均能正常工作）
- ✅ 游戏流程（完整对局流程正常）

AI 性能指标：
- MinimaxAI (深度2)：评估约 2000 个节点
- AlphaBetaAI (深度3)：评估约 5000 个节点
- 搜索速度：> 1000 节点/秒

## 开发信息

- **开发语言**：Python 3.9
- **UI 框架**：Pygame 2.6.1
- **开发时间**：2026-01-19
- **代码行数**：约 2500 行

## 未来扩展

可能的功能扩展：
- [ ] 残局布置功能
- [ ] 棋谱保存/加载（PGN 格式）
- [ ] 开局库支持
- [ ] 残局库支持
- [ ] 网络对弈功能
- [ ] 更多 UI 主题
- [ ] 计时功能
- [ ] 胜负统计

## 许可证

本项目仅供学习和研究使用。

## 致谢

感谢 Pygame 社区提供的优秀游戏开发框架。
